<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Spider::Model::BaseModel [Spider documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Spider::Model::BaseModel
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/spiderfw/model/base_model_rb.html">lib/spiderfw/model/base_model.rb</a>
            (<a href="http://github.com/me/spider/tree/master/lib/spiderfw/model/base_model.rb">view online</a>)
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            The main class for interacting with data. When not dealing with legacy
            storages, subclasses should use <a href="Managed.html">Managed</a> instead,
            which provides an id and other conveniences.
            </p>
            <p>
            Each <a href="BaseModel.html">BaseModel</a> subclass defines a model;
            instances can be used as &#8220;data objects&#8221;: they will interact
            with the <a href="Mapper.html">Mapper</a> loading and saving the values
            associated with the BaseModel&#8217;s defined elements.
            </p>
            <p>
            Each element defines an instance variable, a getter and a setter. If the
            instance is set to autoload, when a getter is first called the mapper will
            fetch the value from the <a href="Storage.html">Storage</a> .
            </p>
            <p>
            Elements can be of one of the base types (<a
            href="../Model.html#M000113">Spider::Model.base_types</a>), of a <a
            href="../DataType.html">DataType</a>, or other models. In the last case,
            they define a relationship between models.
            </p>
            <p>
            Basic usage:
            </p>
            <pre>model Food &lt; BaseModel&#x000A;  element :name, String&#x000A;end&#x000A;model Animal &lt; BaseModel&#x000A;  element :name, String&#x000A;  many :friends, Animal&#x000A;  choice :favorite_food, Food&#x000A;end&#x000A;&#x000A;salmon = Food.new(:name =&gt; 'Salmon')&#x000A;salmon.save&#x000A;cat = Animal.new(:name =&gt; 'Cat', :favorite_food = salmon)&#x000A;weasel = Animal.new(:name =&gt; 'Weasel', :friends =&gt; [cat])&#x000A;weasel.save&#x000A;cat.friends &lt;&lt; weasel&#x000A;cat.save&#x000A;&#x000A;wizzy = Animal.load(:name =&gt; 'Weasel')&#x000A;p wizzy.friends&#x000A;  =&gt; 'Cat'&#x000A;p wizzy.friends[0].favorite_food&#x000A;  =&gt; 'Salmon'&#x000A;&#x000A;bear = Animal.new(:name =&gt; 'Bear', :favorite_food = salmon)&#x000A;bear.save&#x000A;salmon_lovers = Animal.where{ favorite_food == salmon }&#x000A;p salmon_lovers.length&#x000A;  =&gt; 2&#x000A;p salmon_lovers[0].name&#x000A;  =&gt; 'Cat'</pre>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000538">all</a></li>
              <li><a href="#M000499">app</a></li>
              <li><a href="#M000514">attribute</a></li>
              <li><a href="#M000513">attributes</a></li>
              <li><a href="#M000506">choice</a></li>
              <li><a href="#M000509">class_table_inheritance</a></li>
              <li><a href="#M000511">condition</a></li>
              <li><a href="#M000541">count</a></li>
              <li><a href="#M000524">each_element</a></li>
              <li><a href="#M000501">element</a></li>
              <li><a href="#M000504">element_attributes</a></li>
              <li><a href="#M000522">elements</a></li>
              <li><a href="#M000523">elements_array</a></li>
              <li><a href="#M000536">find</a></li>
              <li><a href="#M000527">first_definer</a></li>
              <li><a href="#M000540">free_query_condition</a></li>
              <li><a href="#M000535">get_mapper</a></li>
              <li><a href="#M000533">get_storage</a></li>
              <li><a href="#M000525">has_element?</a></li>
              <li><a href="#M000510">inherit_storage</a></li>
              <li><a href="#M000503">integrate</a></li>
              <li><a href="#M000520">label</a></li>
              <li><a href="#M000521">label_plural</a></li>
              <li><a href="#M000537">load</a></li>
              <li><a href="#M000518">managed?</a></li>
              <li><a href="#M000505">many</a></li>
              <li><a href="#M000534">mapper</a></li>
              <li><a href="#M000528">mapper_include</a></li>
              <li><a href="#M000507">multiple_choice</a></li>
              <li><a href="#M000542">new</a></li>
              <li><a href="#M000512">polymorphic</a></li>
              <li><a href="#M000526">primary_keys</a></li>
              <li><a href="#M000502">remove_element</a></li>
              <li><a href="#M000515">sequence</a></li>
              <li><a href="#M000516">sequences</a></li>
              <li><a href="#M000517">short_name</a></li>
              <li><a href="#M000500">static</a></li>
              <li><a href="#M000532">storage</a></li>
              <li><a href="#M000508">submodels</a></li>
              <li><a href="#M000519">to_s</a></li>
              <li><a href="#M000531">use_storage</a></li>
              <li><a href="#M000539">where</a></li>
              <li><a href="#M000529">with_mapper</a></li>
              <li><a href="#M000530">with_mapper_for</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000566">==</a></li>
              <li><a href="#M000552">[]</a></li>
              <li><a href="#M000553">[]=</a></li>
              <li><a href="#M000547">all_children</a></li>
              <li><a href="#M000563">autoload=</a></li>
              <li><a href="#M000562">autoload?</a></li>
              <li><a href="#M000559">check</a></li>
              <li><a href="#M000591">clear_values</a></li>
              <li><a href="#M000577">clone</a></li>
              <li><a href="#M000595">cut</a></li>
              <li><a href="#M000589">delete</a></li>
              <li><a href="#M000567">each</a></li>
              <li><a href="#M000568">each_val</a></li>
              <li><a href="#M000570">element_has_value?</a></li>
              <li><a href="#M000557">element_loaded</a></li>
              <li><a href="#M000558">element_loaded?</a></li>
              <li><a href="#M000571">element_modified?</a></li>
              <li><a href="#M000572">elements_modified?</a></li>
              <li><a href="#M000575">empty?</a></li>
              <li><a href="#M000549">get</a></li>
              <li><a href="#M000578">get_new</a></li>
              <li><a href="#M000550">get_no_load</a></li>
              <li><a href="#M000543">identity_mapper</a></li>
              <li><a href="#M000544">identity_mapper=</a></li>
              <li><a href="#M000587">insert</a></li>
              <li><a href="#M000593">inspect</a></li>
              <li><a href="#M000545">instantiate_element</a></li>
              <li><a href="#M000579">keys_to_condition</a></li>
              <li><a href="#M000590">load</a></li>
              <li><a href="#M000583">mapper</a></li>
              <li><a href="#M000584">mapper=</a></li>
              <li><a href="#M000576">merge!</a></li>
              <li><a href="#M000573">modified?</a></li>
              <li><a href="#M000564">no_autoload</a></li>
              <li><a href="#M000580">observe_all_values</a></li>
              <li><a href="#M000560">polymorphic_become</a></li>
              <li><a href="#M000546">prepare_child</a></li>
              <li><a href="#M000555">prepare_value</a></li>
              <li><a href="#M000569">primary_keys</a></li>
              <li><a href="#M000574">primary_keys_set?</a></li>
              <li><a href="#M000585">save</a></li>
              <li><a href="#M000586">save_all</a></li>
              <li><a href="#M000565">save_mode</a></li>
              <li><a href="#M000551">set</a></li>
              <li><a href="#M000554">set_hash</a></li>
              <li><a href="#M000556">set_loaded_value</a></li>
              <li><a href="#M000548">set_parent</a></li>
              <li><a href="#M000581">storage</a></li>
              <li><a href="#M000561">subclass</a></li>
              <li><a href="#M000596">to_hash</a></li>
              <li><a href="#M000594">to_json</a></li>
              <li><a href="#M000592">to_s</a></li>
              <li><a href="#M000588">update</a></li>
              <li><a href="#M000582">use_storage</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a href="../Logger.html">Spider::Logger</a></li>
                <li><a href="../DataTypes.html">DataTypes</a></li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>_parent</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      <a href="../Model.html">Model</a> instance or <a
                      href="QuerySet.html">QuerySet</a> containing the object
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>_parent_element</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      If _parent is a model instance, which element points to this one
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>attributes</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of model attributes. They can be used freely.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>elements_order</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An array of element names, in definition order.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>extended_models</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of extended models => element name of the extended model element
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>integrated_models</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of integrated models => corresponding integrated element name.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>loaded_elements</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of loaded elements
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>model</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The <a href="BaseModel.html">BaseModel</a> class itself. Used when dealing
                      with proxy objects.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>polymorphic_models</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of polymorphic models => polymorphic params
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>sequences</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Array of named sequences.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000538'>
                <a name='M000538'>      </a>
                <div class='synopsis'>
                  <span class='name'>all</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a queryset without conditions
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000538-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000538-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 802</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">all</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000499'>
                <a name='M000499'>      </a>
                <div class='synopsis'>
                  <span class='name'>app</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the parent <a href="../App.html">Spider::App</a> of the module
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000499-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000499-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 94</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">app</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@app</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@app</span>&#x000A;            <span class="ruby-identifier">app</span> = <span class="ruby-keyword kw">self</span>&#x000A;            <span class="ruby-keyword kw">while</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">app</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span>))&#x000A;                <span class="ruby-identifier">app</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">parent_module</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000514'>
                <a name='M000514'>      </a>
                <div class='synopsis'>
                  <span class='name'>attribute</span>
                  <span class='arguments'>(name, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets a model attribute. See self.attributes
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000514-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000514-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 600</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-ivar">@attributes</span> <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-ivar">@attributes</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000513'>
                <a name='M000513'>      </a>
                <div class='synopsis'>
                  <span class='name'>attributes</span>
                  <span class='arguments'>(val=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets or gets class attributes (a Hash). If given a hash of attributes, will
                  merge them with class attributes. <a href="../Model.html">Model</a>
                  attributes are generally empty, and can be used by apps.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000513-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000513-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 591</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>(<span class="ruby-identifier">val</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-ivar">@attributes</span> <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">val</span>)&#x000A;                <span class="ruby-ivar">@attributes</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-ivar">@attributes</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000506'>
                <a name='M000506'>      </a>
                <div class='synopsis'>
                  <span class='name'>choice</span>
                  <span class='arguments'>(name, type, attributes={}, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Defines an element with choice association. Shorthand for
                  </p>
                  <pre>element(name, type, :association =&gt; :choice, ...)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000506-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000506-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 464</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">choice</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:association</span>] = <span class="ruby-identifier">:choice</span>&#x000A;            <span class="ruby-identifier">element</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000509'>
                <a name='M000509'>      </a>
                <div class='synopsis'>
                  <span class='name'>class_table_inheritance</span>
                  <span class='arguments'>(params={})</span>
                </div>
                <div class='description'>
                  <p>
                  Externalizes the superclass elements making the superclass an external
                  integrated element. Parameters may be:
                  </p>
                  <ul>
                  <li>:name (symbol) name of the created element
                  
                  </li>
                  <li>:delete_cascade (bool) delete cascade the superclass instance
                  
                  </li>
                  <li>:no_local_pk (bool) do not define an id for this class
                  
                  </li>
                  <li>:add_polymorphic (bool) notify the superclass that it is extended, making
                  polymorphic queries possible
                  
                  </li>
                  </ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000509-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000509-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 545</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class_table_inheritance</span>(<span class="ruby-identifier">params</span>={})&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extend_model</span>(<span class="ruby-identifier">superclass</span>, <span class="ruby-identifier">params</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000511'>
                <a name='M000511'>      </a>
                <div class='synopsis'>
                  <span class='name'>condition</span>
                  <span class='arguments'>(condition)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets a fixed condition.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000511-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000511-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 560</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">condition</span>(<span class="ruby-identifier">condition</span>)&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:condition</span>] = <span class="ruby-identifier">condition</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000541'>
                <a name='M000541'>      </a>
                <div class='synopsis'>
                  <span class='name'>count</span>
                  <span class='arguments'>(condition=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the number of objects in storage
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000541-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000541-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 848</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">condition</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">condition</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000524'>
                <a name='M000524'>      </a>
                <div class='synopsis'>
                  <span class='name'>each_element</span>
                  <span class='arguments'>() {|elements[name]| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Yields each element in order.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000524-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000524-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 664</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">each_element</span>&#x000A;            <span class="ruby-ivar">@elements_order</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000501'>
                <a name='M000501'>      </a>
                <div class='synopsis'>
                  <span class='name'>element</span>
                  <span class='arguments'>(name, type, attributes={}, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Defines an element. Arguments are element name (a <a
                  href="../../Symbol.html">Symbol</a>), element type, and a Hash of
                  attributes.
                  </p>
                  <p>
                  <a href="Type.html">Type</a> may be a Class: a base type (see <a
                  href="../Model.html#M000113">Spider::Model.base_types</a>), a <a
                  href="../DataType.html">DataType</a> subclass, or a <a
                  href="BaseModel.html">BaseModel</a> subclass; or an Array or a Hash, in
                  which case an <a href="InlineModel.html">InlineModel</a> will be created.
                  </p>
                  <p>
                  An <a href="Element.html">Element</a> instance will be available in <a
                  href="BaseModel.html#M000522">Model::BaseModel.elements</a>; getter and
                  setter methods will be defined on the class.
                  </p>
                  <p>
                  If a block is passed to this method, type will be &#8216;extended&#8217;: a
                  custom junction association will be created, effectively adding elements to
                  the type only in this model&#8217;s context. Example:
                  </p>
                  <pre>class Animal &lt; BaseModel&#x000A;  element :name, String&#x000A;  element :friends, Animal, :multiple =&gt; true do&#x000A;    element :how_much, String&#x000A;  end&#x000A;end&#x000A;cat = Animal.new(:name =&gt; 'Cat')&#x000A;dog = Animal.new(:name =&gt; 'Dog')&#x000A;cat.friends &lt;&lt; dog&#x000A;cat.friend[0].how_much = 'Not very much'</pre>
                  <p>
                  Returns the created <a href="Element.html">Element</a>.
                  </p>
                  <p>
                  Some used attributes:
                  </p>
                  <table>
                  <tr><td valign="top">:primary_key:</td><td>(bool) The element is a primary key
                  
                  </td></tr>
                  <tr><td valign="top">:length:</td><td>(number) Maximum length of the element (if meaningful)
                  
                  </td></tr>
                  <tr><td valign="top">:required:</td><td>(bool) The element must always have a value
                  
                  </td></tr>
                  <tr><td valign="top">:multiple:</td><td>(bool) defines a 1|n -> n relationship
                  
                  </td></tr>
                  <tr><td valign="top">:label:</td><td>(string) a short description, used by the UI
                  
                  </td></tr>
                  <tr><td valign="top">:association:</td><td>(symbol) A named association (such as :choice, :<a
                  href="BaseModel.html#M000507">multiple_choice</a>, etc.)
                  
                  </td></tr>
                  <tr><td valign="top">:lazy:</td><td>(bool, array or symbol) If true, the element will be placed in the :default
                  lazy group; if a symbol or an array of symbols is passed, the element will
                  be placed in those groups. (see <a
                  href="Element.html#M000690">Element#lazy_groups</a>)
                  
                  </td></tr>
                  <tr><td valign="top">:reverse:</td><td>(symbol) The reverse element in the relationship to the other model
                  
                  </td></tr>
                  <tr><td valign="top">:add_reverse:</td><td>(symbol) Adds an element on the other model, and sets it as the association
                  reverse.
                  
                  </td></tr>
                  <tr><td valign="top">:add_multiple_reverse:</td><td>(symbol) Adds a multiple element on the other model, and sets it as the
                  association reverse.
                  
                  </td></tr>
                  <tr><td valign="top">:element_position:</td><td>(number) inserts the element at the specified position in the elements
                  order
                  
                  </td></tr>
                  <tr><td valign="top">:auto:</td><td>(bool) Informative: the value is set automatically through some mechanism
                  
                  </td></tr>
                  <tr><td valign="top">:autoincrement:</td><td>(bool) The value (which must be a Fixnum) will be autoincremented by the
                  mapper
                  
                  </td></tr>
                  <tr><td valign="top">:integrate:</td><td>(bool or symbol) type&#8217;s elements will be available to this class as
                  if they were defined here (see <a
                  href="BaseModel.html#M000503">integrate</a>)
                  
                  </td></tr>
                  <tr><td valign="top">:integrated_from:</td><td>(symbol) the name of the element from which this element is integrated
                  
                  </td></tr>
                  <tr><td valign="top">:integrated_from_element:</td><td>(symbol) the name of the element of the child object from which this
                  element is integrated
                  
                  </td></tr>
                  <tr><td valign="top">:hidden:</td><td>(bool) a hint that the element shouldn&#8217;t be shown by the UI
                  
                  </td></tr>
                  <tr><td valign="top">:computed_from:</td><td>(array of symbols) the element is not mapped; its value is computed by the
                  class from the given elements.
                  
                  </td></tr>
                  <tr><td valign="top">:check:</td><td>(a Proc, or a Regexp, or a Hash of messages => Regexp|Proc). See <a
                  href="BaseModel.html#M000559">check</a>
                  
                  </td></tr>
                  <tr><td valign="top">:through:</td><td>(a <a href="BaseModel.html">BaseModel</a> subclass) model representing the
                  many to many relationship.
                  
                  </td></tr>
                  <tr><td valign="top">:read_only:</td><td>(bool) hint to the UI that the element should not be user modifiable.
                  
                  </td></tr>
                  <tr><td valign="top">:owned:</td><td>(bool) only this model holds references to type
                  
                  </td></tr>
                  <tr><td valign="top">:condition:</td><td>(hash or <a href="Condition.html">Condition</a>) Restricts an association
                  always adding the condition.
                  
                  </td></tr>
                  </table>
                  <p>
                  Other attributes may be used by <a href="../DataTypes.html">DataTypes</a>
                  (see <a
                  href="../DataType/ClassMethods.html#M000765">DataType::ClassMethods.take_attributes</a>),
                  and other code. See also <a href="Element.html">Element</a>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000501-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000501-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 170</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-ivar">@elements</span> <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-ivar">@elements_order</span> <span class="ruby-operator">||=</span> []&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Class</span>&#x000A;                <span class="ruby-identifier">default_attributes</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span>&#x000A;                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'String'</span>&#x000A;                    {<span class="ruby-identifier">:length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">255</span>}&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    {}&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">default_attributes</span> = {}&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">default_attributes</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-comment cmt"># if (type.class == Class &amp;&amp; Model.base_type(type)) </span>&#x000A;            <span class="ruby-comment cmt">#                 type = Model.base_type(type)</span>&#x000A;            <span class="ruby-comment cmt">#             els</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Hash</span>)&#x000A;                <span class="ruby-identifier">type</span> = <span class="ruby-identifier">create_inline_model</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>)&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:inline</span>] = <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from</span>])&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>)&#x000A;                    <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>)&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from</span>] = <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_sym</span>]&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from_element</span>] = <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>]&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from_element</span>])&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_from_element</span>] = <span class="ruby-identifier">name</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;&#x000A;&#x000A;            <span class="ruby-identifier">orig_type</span> = <span class="ruby-identifier">type</span>&#x000A;            <span class="ruby-identifier">assoc_type</span> = <span class="ruby-keyword kw">nil</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:multiple</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>] <span class="ruby-operator">||</span> \&#x000A;                <span class="ruby-comment cmt"># FIXME! the first check is needed when the referenced class has not been parsed yet </span>&#x000A;                <span class="ruby-comment cmt"># but now it assumes that the reverse is not multiple if it is not defined</span>&#x000A;                (<span class="ruby-operator">!</span><span class="ruby-identifier">type</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>]] <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>]].<span class="ruby-identifier">multiple?</span>)))&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:anonymous_model</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:owned</span>] = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:owned</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-identifier">first_model</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_definer</span>(<span class="ruby-identifier">name</span>)&#x000A;                <span class="ruby-identifier">assoc_type_name</span> = <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">camelize</span>(<span class="ruby-identifier">name</span>)&#x000A;                <span class="ruby-identifier">create_junction</span> = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:through</span>])&#x000A;                    <span class="ruby-identifier">assoc_type</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:through</span>]&#x000A;                    <span class="ruby-identifier">create_junction</span> = <span class="ruby-keyword kw">false</span>&#x000A;                <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">first_model</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">assoc_type_name</span>) )&#x000A;                    <span class="ruby-identifier">assoc_type</span> = <span class="ruby-identifier">first_model</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">assoc_type_name</span>)&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:sub_model</span>]) <span class="ruby-comment cmt"># other kind of inline model</span>&#x000A;                        <span class="ruby-identifier">assoc_type_name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'Junction'</span>&#x000A;                        <span class="ruby-identifier">create_junction</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">first_model</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">assoc_type_name</span>))&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-identifier">create_junction</span> = <span class="ruby-keyword kw">false</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_id</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">:id</span>&#x000A;                <span class="ruby-identifier">self_name</span> = <span class="ruby-identifier">first_model</span>.<span class="ruby-identifier">short_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">to_sym</span>&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>] = <span class="ruby-identifier">self_name</span>&#x000A;                <span class="ruby-identifier">other_name</span> = <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">underscore</span>(<span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">short_name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">short_name</span> <span class="ruby-value">? </span><span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">short_name</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">to_sym</span>&#x000A;                <span class="ruby-identifier">other_name</span> = <span class="ruby-identifier">:&quot;#{other_name}_ref&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">other_name</span>])&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_their_element</span>] = <span class="ruby-identifier">other_name</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">create_junction</span>)&#x000A;                    <span class="ruby-identifier">assoc_type</span> = <span class="ruby-identifier">first_model</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-identifier">assoc_type_name</span>, <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">BaseModel</span>))&#x000A;                    <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:sub_model</span>] = <span class="ruby-keyword kw">self</span>&#x000A;                    <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_id</span>], <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">:primary_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:autoincrement</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:hidden</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)&#x000A;                    <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">self_name</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:hidden</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>) <span class="ruby-comment cmt"># FIXME: must check if reverse exists?</span>&#x000A;                    <span class="ruby-comment cmt"># FIXME! fix in case of clashes with existent elements</span>&#x000A;                    <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">other_name</span>, <span class="ruby-identifier">orig_type</span>)&#x000A;                    <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">integrate</span>(<span class="ruby-identifier">other_name</span>, <span class="ruby-identifier">:hidden</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:no_pks</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-comment cmt"># FIXME: in some cases we want the integrated elements</span>&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">proc</span>)                                   <span class="ruby-comment cmt">#        to be hidden, but the integrated el instead</span>&#x000A;                        <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:extended</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                        <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:keep_junction</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                        <span class="ruby-identifier">assoc_type</span>.<span class="ruby-identifier">class_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:association_type</span>] = <span class="ruby-identifier">assoc_type</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            &#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>))&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>] = {<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>]}&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>))&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>] = {<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>]}&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>])&#x000A;                <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>]])&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>][<span class="ruby-identifier">:name</span>]&#x000A;                    <span class="ruby-identifier">rev</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">:added_reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, &#x000A;                        <span class="ruby-identifier">:delete_cascade</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse_delete_cascade</span>])&#x000A;                    <span class="ruby-identifier">rev</span>[<span class="ruby-identifier">:through</span>] = <span class="ruby-identifier">assoc_type</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">assoc_type</span>&#x000A;                    <span class="ruby-identifier">rev_name</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:name</span>)&#x000A;                    <span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">rev_name</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">rev</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>])&#x000A;                <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>]])&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>][<span class="ruby-identifier">:name</span>]&#x000A;                    <span class="ruby-identifier">rev</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">:multiple</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, &#x000A;                        <span class="ruby-identifier">:added_reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:delete_cascade</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse_delete_cascade</span>])&#x000A;                    <span class="ruby-identifier">rev</span>[<span class="ruby-identifier">:through</span>] = <span class="ruby-identifier">assoc_type</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">assoc_type</span>&#x000A;                    <span class="ruby-identifier">rev_name</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:name</span>)&#x000A;                    <span class="ruby-identifier">orig_type</span>.<span class="ruby-identifier">element</span>(<span class="ruby-identifier">rev_name</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">rev</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:lazy</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span>.<span class="ruby-identifier">subclass_of?</span>(<span class="ruby-constant">BaseModel</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:multiple</span>])&#x000A;                    <span class="ruby-comment cmt"># FIXME: we can load eagerly single relations if we can do a join</span>&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:lazy</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:lazy</span>] = <span class="ruby-identifier">:default</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            &#x000A;            &#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:element_position</span>])&#x000A;                <span class="ruby-ivar">@elements_order</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:element_position</span>], <span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-ivar">@elements_order</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            <span class="ruby-comment cmt"># class element getter</span>&#x000A;            <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">name</span>)&#x000A;                (<span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">end</span>).<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>&#x000A;                    <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{name}&quot;</span>) <span class="ruby-keyword kw">do</span>&#x000A;                        <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">name</span>]&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            <span class="ruby-identifier">ivar</span> = <span class="ruby-identifier">:&quot;@#{ name }&quot;</span>&#x000A;            &#x000A;            <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">:ElementMethods</span>)&#x000A;                <span class="ruby-identifier">em</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-identifier">:ElementMethods</span>, <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>)&#x000A;                <span class="ruby-identifier">include</span> <span class="ruby-identifier">em</span>&#x000A;                &#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">element_methods</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">:ElementMethods</span>)&#x000A;&#x000A;            <span class="ruby-comment cmt">#instance variable getter</span>&#x000A;            <span class="ruby-identifier">element_methods</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:define_method</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span>&#x000A;                <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                    <span class="ruby-identifier">integrated</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>.<span class="ruby-identifier">name</span>)&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">integrated</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from_element</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">integrated</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">element_loaded?</span>(<span class="ruby-identifier">name</span>)&#x000A;                    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">ivar</span>) &#x000A;                    <span class="ruby-identifier">val</span>.<span class="ruby-identifier">set_parent</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">val</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;&#x000A;<span class="ruby-comment cmt">#                Spider.logger.debug(&quot;Element not loaded #{name} (i'm #{self.class} #{self.object_id})&quot;)</span>&#x000A;                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">autoload?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">primary_keys_set?</span>&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">autoload?</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:save_mode</span>)&#x000A;                        <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">load_element!</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">element</span>)&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">load_element</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">element</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">ivar</span>)&#x000A;                    <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>)&#x000A;                <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>)&#x000A;                    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">ivar</span>, <span class="ruby-identifier">instantiate_element</span>(<span class="ruby-identifier">name</span>))&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">val</span>.<span class="ruby-identifier">set_parent</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">val</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;&#x000A;            <span class="ruby-comment cmt">#instance_variable_setter</span>&#x000A;            <span class="ruby-identifier">element_methods</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:define_method</span>, <span class="ruby-node">&quot;#{name}=&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;                <span class="ruby-comment cmt">#@_autoload = false unless element.primary_key?</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                    <span class="ruby-identifier">integrated_obj</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>)&#x000A;                    <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">integrated_obj</span>&#x000A;                        <span class="ruby-identifier">integrated_obj</span> = <span class="ruby-identifier">instantiate_element</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>.<span class="ruby-identifier">name</span>)&#x000A;                        <span class="ruby-identifier">set</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>, <span class="ruby-identifier">integrated_obj</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-comment cmt">#integrated_obj.autoload = false</span>&#x000A;                    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">integrated_obj</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{element.integrated_from_element}=&quot;</span>, <span class="ruby-identifier">val</span>)&#x000A;                    <span class="ruby-ivar">@modified_elements</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">primary_key?</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">val</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>)&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">multiple?</span>)&#x000A;                        <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">QuerySet</span>))&#x000A;                            <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">instantiate_element</span>(<span class="ruby-identifier">name</span>)&#x000A;                            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Enumerable</span>))&#x000A;                                <span class="ruby-identifier">val</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;                                    <span class="ruby-identifier">row</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">row</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">BaseModel</span>)&#x000A;                                    <span class="ruby-identifier">qs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>&#x000A;                                <span class="ruby-keyword kw">end</span>&#x000A;                            <span class="ruby-keyword kw">else</span>&#x000A;                                <span class="ruby-identifier">qs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span>&#x000A;                            <span class="ruby-keyword kw">end</span>&#x000A;                            <span class="ruby-identifier">val</span> = <span class="ruby-identifier">qs</span>&#x000A;                        <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">val</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">BaseModel</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">val</span> = <span class="ruby-identifier">prepare_child</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>)&#x000A;                <span class="ruby-identifier">old_val</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">ivar</span>)&#x000A;                <span class="ruby-identifier">check</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>)&#x000A;                <span class="ruby-ivar">@modified_elements</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">primary_key?</span>&#x000A;                <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">ivar</span>, <span class="ruby-identifier">val</span>)&#x000A;                <span class="ruby-identifier">notify_observers</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">old_val</span>)&#x000A;                <span class="ruby-comment cmt">#extend_element(name)</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            &#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrate</span>])&#x000A;                <span class="ruby-identifier">integrate</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrate</span>])&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@subclasses</span>)&#x000A;                <span class="ruby-ivar">@subclasses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sub</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">sub</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">clone</span>&#x000A;                    <span class="ruby-identifier">sub</span>.<span class="ruby-identifier">elements_order</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">name</span>]&#x000A;&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000504'>
                <a name='M000504'>      </a>
                <div class='synopsis'>
                  <span class='name'>element_attributes</span>
                  <span class='arguments'>(element_name, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets additional attributes on the element
                  </p>
                  <p>
                  <em>Warning:</em> for attributes which are parsed by the <a
                  href="BaseModel.html">BaseModel</a> during element definition, this will
                  not have the desired effect; remove and redefine the element instead.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000504-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000504-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 450</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">element_attributes</span>(<span class="ruby-identifier">element_name</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>].<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">attributes</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000522'>
                <a name='M000522'>      </a>
                <div class='synopsis'>
                  <span class='name'>elements</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  An Hash of Elements, indexed by name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000522-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000522-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 654</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">elements</span>&#x000A;            <span class="ruby-ivar">@elements</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000523'>
                <a name='M000523'>      </a>
                <div class='synopsis'>
                  <span class='name'>elements_array</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  An array of the model&#8217;s Elements.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000523-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000523-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 659</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">elements_array</span>&#x000A;            <span class="ruby-ivar">@elements_order</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@elements</span>[<span class="ruby-identifier">key</span>] }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000536'>
                <a name='M000536'>      </a>
                <div class='synopsis'>
                  <span class='name'>find</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Executes self.where, and calls <a
                  href="QuerySet.html#M000472">QuerySet#load</a> on the result. Returns nil
                  if the result is empty, the <a href="QuerySet.html">QuerySet</a> otherwise
                  See self.where for parameter syntax
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000536-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000536-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 790</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">qs</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">qs</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">qs</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000527'>
                <a name='M000527'>      </a>
                <div class='synopsis'>
                  <span class='name'>first_definer</span>
                  <span class='arguments'>(element_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the model actually defining element_name; that could be the model
                  itself, a superclass, or an integrated model.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000527-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000527-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 682</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_definer</span>(<span class="ruby-identifier">element_name</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">elements</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>])&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">first_definer</span>(<span class="ruby-identifier">element_name</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_models</span>])&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_models</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mod</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">first_definer</span>(<span class="ruby-identifier">element_name</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">mod</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>])&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000540'>
                <a name='M000540'>      </a>
                <div class='synopsis'>
                  <span class='name'>free_query_condition</span>
                  <span class='arguments'>(q)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the condition for a &#8220;free&#8221; text query Examples:
                  </p>
                  <pre>condition = News.free_query_condition('animals')&#x000A;animal_news = News.where(condition)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000540-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000540-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 837</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">free_query_condition</span>(<span class="ruby-identifier">q</span>)&#x000A;            <span class="ruby-identifier">c</span> = <span class="ruby-constant">Condition</span>.<span class="ruby-identifier">or</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Text</span>)&#x000A;                    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value str">'ilike'</span>, <span class="ruby-value str">'%'</span><span class="ruby-operator">+</span><span class="ruby-identifier">q</span><span class="ruby-operator">+</span><span class="ruby-value str">'%'</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">c</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000535'>
                <a name='M000535'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_mapper</span>
                  <span class='arguments'>(storage)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an instance of the mapper for the given storage
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000535-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000535-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 772</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_mapper</span>(<span class="ruby-identifier">storage</span>)&#x000A;<span class="ruby-comment cmt">#            map_class = self.attributes[:inherit_storage] ? superclass : self</span>&#x000A;            <span class="ruby-identifier">mapper</span> = <span class="ruby-identifier">storage</span>.<span class="ruby-identifier">get_mapper</span>(<span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@mapper_modules</span>)&#x000A;                <span class="ruby-ivar">@mapper_modules</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">mod</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-identifier">mod</span>) }&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@mapper_procs</span>)&#x000A;                <span class="ruby-ivar">@mapper_procs</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">proc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>) }&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@mapper_procs_subclass</span>)&#x000A;                <span class="ruby-ivar">@mapper_procs_subclass</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">proc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>) }&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mapper</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000533'>
                <a name='M000533'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_storage</span>
                  <span class='arguments'>(storage_string='default')</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an instancethe storage corresponding to the storage_string if it is
                  given, or of the default storage otherwise. The storage string can be a
                  storage url (see <a href="Storage.html">Storage</a>.<a
                  href="BaseModel.html#M000533">get_storage</a>), or a named storage defined
                  in configuration
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000533-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000533-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 750</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_storage</span>(<span class="ruby-identifier">storage_string</span>=<span class="ruby-value str">'default'</span>)&#x000A;            <span class="ruby-identifier">storage_regexp</span> = <span class="ruby-regexp re">/([\w\d]+?):(.+)/</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">storage_string</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">storage_regexp</span>)&#x000A;                <span class="ruby-identifier">orig_string</span> = <span class="ruby-identifier">storage_string</span>&#x000A;                <span class="ruby-identifier">storage_conf</span> = <span class="ruby-constant">Spider</span>.<span class="ruby-identifier">conf</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value str">'storages'</span>)[<span class="ruby-identifier">storage_string</span>]&#x000A;                <span class="ruby-identifier">storage_string</span> = <span class="ruby-identifier">storage_conf</span>[<span class="ruby-value str">'url'</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">storage_conf</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">storage_string</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">storage_string</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">storage_regexp</span>)&#x000A;                    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ModelException</span>, <span class="ruby-node">&quot;No storage '#{orig_string}' found&quot;</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">type</span>, <span class="ruby-identifier">url</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>&#x000A;            <span class="ruby-identifier">storage</span> = <span class="ruby-constant">Storage</span>.<span class="ruby-identifier">get_storage</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">url</span>)&#x000A;            <span class="ruby-identifier">storage</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-identifier">storage_conf</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">storage_conf</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">storage</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000525'>
                <a name='M000525'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_element?</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the model has given element name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000525-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000525-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 671</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_element?</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000510'>
                <a name='M000510'>      </a>
                <div class='synopsis'>
                  <span class='name'>inherit_storage</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Makes the class use the superclass storage
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000510-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000510-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 550</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">inherit_storage</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:inherit_storage</span>] = <span class="ruby-keyword kw">true</span>&#x000A;            (<span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">end</span>).<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>&#x000A;                <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:storage</span>) <span class="ruby-keyword kw">do</span>&#x000A;                    <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">storage</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000503'>
                <a name='M000503'>      </a>
                <div class='synopsis'>
                  <span class='name'>integrate</span>
                  <span class='arguments'>(element_name, params={})</span>
                </div>
                <div class='description'>
                  <p>
                  Integrates an element: any call to the child object&#8217;s elements will
                  be passed to the child. The element must not be multiple. Example:
                  </p>
                  <pre>class Address &lt; BaseModel&#x000A;  element :street, String&#x000A;  element :area_code, String&#x000A;end&#x000A;class Person &lt; BaseModel&#x000A;  element :name, String&#x000A;  element :address, Address&#x000A;  integrate :address&#x000A;end&#x000A;p = Person.new(...)&#x000A;p.street == p.address.street</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000503-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000503-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 422</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">integrate</span>(<span class="ruby-identifier">element_name</span>, <span class="ruby-identifier">params</span>={})&#x000A;            <span class="ruby-identifier">params</span> <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>].<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_model</span>] = <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-identifier">model</span> = <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>].<span class="ruby-identifier">model</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_models</span>] <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_models</span>][<span class="ruby-identifier">model</span>] = <span class="ruby-identifier">element_name</span>&#x000A;            <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:except</span>] <span class="ruby-operator">||=</span> []&#x000A;            <span class="ruby-identifier">model</span>.<span class="ruby-identifier">each_element</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:except</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span>)&#x000A;                <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span>] <span class="ruby-comment cmt"># don't overwrite existing elements</span>&#x000A;                <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">clone</span>.<span class="ruby-identifier">merge</span>({&#x000A;                    <span class="ruby-identifier">:integrated_from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>]&#x000A;                })&#x000A;                <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:hidden</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hidden</span>] <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hidden</span>].<span class="ruby-identifier">nil?</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">add_rev</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_reverse</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:add_multiple_reverse</span>])&#x000A;                    <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:reverse</span>] = <span class="ruby-identifier">add_rev</span>&#x000A;                    <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:add_reverse</span>)&#x000A;                    <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:add_multiple_reverse</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:primary_key</span>) <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:keep_pks</span>])&#x000A;                <span class="ruby-identifier">element</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000520'>
                <a name='M000520'>      </a>
                <div class='synopsis'>
                  <span class='name'>label</span>
                  <span class='arguments'>(sing=nil, plur=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the singolar and/or the plural label for the model Returns the
                  singlular label
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000520-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000520-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 637</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">label</span>(<span class="ruby-identifier">sing</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">plur</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-ivar">@label</span> = <span class="ruby-identifier">sing</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sing</span>&#x000A;            <span class="ruby-ivar">@label_plural</span> = <span class="ruby-identifier">plur</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">plur</span>&#x000A;            <span class="ruby-ivar">@label</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000521'>
                <a name='M000521'>      </a>
                <div class='synopsis'>
                  <span class='name'>label_plural</span>
                  <span class='arguments'>(val=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets/retrieves the plural form for the label
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000521-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000521-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 644</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">label_plural</span>(<span class="ruby-identifier">val</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-ivar">@label_plural</span> = <span class="ruby-identifier">val</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-ivar">@label_plural</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000537'>
                <a name='M000537'>      </a>
                <div class='synopsis'>
                  <span class='name'>load</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Executes self.where, returning the first result. See self.where for
                  parameter syntax.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000537-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000537-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 797</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">load</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)[<span class="ruby-value">0</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000518'>
                <a name='M000518'>      </a>
                <div class='synopsis'>
                  <span class='name'>managed?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  False for <a href="BaseModel.html">BaseModel</a> (true for <a
                  href="Managed.html">Spider::Model::Managed</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000518-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000518-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 626</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">managed?</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000505'>
                <a name='M000505'>      </a>
                <div class='synopsis'>
                  <span class='name'>many</span>
                  <span class='arguments'>(name, type, attributes={}, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Defines a multiple element. Equivalent to calling
                  </p>
                  <pre>element(name, type, :multiple =&gt; true, :association =&gt; :many, ...)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000505-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000505-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 456</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">many</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:multiple</span>] = <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:association</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">:many</span>&#x000A;            <span class="ruby-identifier">element</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000534'>
                <a name='M000534'>      </a>
                <div class='synopsis'>
                  <span class='name'>mapper</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an instance of the default mapper for the class.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000534-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000534-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 767</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mapper</span>&#x000A;            <span class="ruby-ivar">@mapper</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">get_mapper</span>(<span class="ruby-identifier">storage</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000528'>
                <a name='M000528'>      </a>
                <div class='synopsis'>
                  <span class='name'>mapper_include</span>
                  <span class='arguments'>(mod)</span>
                </div>
                <div class='description'>
                  <p>
                  The given module will be mixed in any mapper used by the class.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000528-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000528-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 699</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mapper_include</span>(<span class="ruby-identifier">mod</span>)&#x000A;            <span class="ruby-ivar">@mapper_modules</span> <span class="ruby-operator">||=</span> []&#x000A;            <span class="ruby-ivar">@mapper_modules</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">mod</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000507'>
                <a name='M000507'>      </a>
                <div class='synopsis'>
                  <span class='name'>multiple_choice</span>
                  <span class='arguments'>(name, type, attributes={}, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Defines a multiple element with :<a
                  href="BaseModel.html#M000507">multiple_choice</a> association. Shorthand
                  for
                  </p>
                  <pre>many(name, type, :association =&gt; :multiple_choice, ...)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000507-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000507-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 471</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">multiple_choice</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:association</span>] = <span class="ruby-identifier">:multiple_choice</span>&#x000A;            <span class="ruby-identifier">many</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000542'>
                <a name='M000542'>      </a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(values=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  The constructor may take:
                  </p>
                  <ul>
                  <li>an Hash of values, that will be set on the new instance; or
                  
                  </li>
                  <li>a <a href="BaseModel.html">BaseModel</a> instance; its values will be set
                  on the new instance; or
                  
                  </li>
                  <li>a single value; it will be set on the first primary key.
                  
                  </li>
                  </ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000542-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000542-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 861</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">values</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-ivar">@_autoload</span> = <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-ivar">@_has_values</span> = <span class="ruby-keyword kw">false</span>&#x000A;            <span class="ruby-ivar">@loaded_elements</span> = {}&#x000A;            <span class="ruby-ivar">@modified_elements</span> = {}&#x000A;            <span class="ruby-ivar">@value_observers</span> = {}&#x000A;            <span class="ruby-ivar">@all_values_observers</span> = []&#x000A;            <span class="ruby-ivar">@_extra</span> = {}&#x000A;            <span class="ruby-ivar">@model</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>&#x000A;            <span class="ruby-ivar">@all_values_observers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element</span>, <span class="ruby-identifier">old_value</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-ivar">@_has_values</span> = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">unit_of_work</span>.<span class="ruby-identifier">add</span>(<span class="ruby-keyword kw">self</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">unit_of_work</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">values</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>)&#x000A;                    <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>&#x000A;                        <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">BaseModel</span>)&#x000A;                    <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each_val</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>&#x000A;                        <span class="ruby-identifier">set</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">has_element?</span>(<span class="ruby-identifier">name</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                 <span class="ruby-comment cmt"># Single unset key, single value</span>&#x000A;                <span class="ruby-keyword kw">elsif</span> ((<span class="ruby-identifier">empty_keys</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">key</span>) }).<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>)&#x000A;                    <span class="ruby-identifier">set</span>(<span class="ruby-identifier">empty_keys</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">values</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000512'>
                <a name='M000512'>      </a>
                <div class='synopsis'>
                  <span class='name'>polymorphic</span>
                  <span class='arguments'>(model, options)</span>
                </div>
                <div class='description'>
                  <p>
                  Add a subclass, allowing polymorphic queries on it.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000512-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000512-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 581</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">polymorphic</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">options</span>)&#x000A;            <span class="ruby-identifier">through</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:through</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">underscore</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>)&#x000A;            <span class="ruby-identifier">through</span> = <span class="ruby-identifier">through</span>.<span class="ruby-identifier">to_sym</span>&#x000A;            <span class="ruby-ivar">@polymorphic_models</span> <span class="ruby-operator">||=</span> {}&#x000A;            <span class="ruby-ivar">@polymorphic_models</span>[<span class="ruby-identifier">model</span>] = {<span class="ruby-identifier">:through</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">through</span>}&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000526'>
                <a name='M000526'>      </a>
                <div class='synopsis'>
                  <span class='name'>primary_keys</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  An array of elements with primary_key attribute set.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000526-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000526-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 676</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">primary_keys</span>&#x000A;            <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:primary_key</span>]}&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000502'>
                <a name='M000502'>      </a>
                <div class='synopsis'>
                  <span class='name'>remove_element</span>
                  <span class='arguments'>(el)</span>
                </div>
                <div class='description'>
                  <p>
                  Removes a defined element
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000502-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000502-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 402</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">remove_element</span>(<span class="ruby-identifier">el</span>)&#x000A;            <span class="ruby-identifier">el</span> = <span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-ivar">@elements</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">el</span>)&#x000A;            <span class="ruby-ivar">@elements_order</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">el</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000515'>
                <a name='M000515'>      </a>
                <div class='synopsis'>
                  <span class='name'>sequence</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Adds a sequence to the model.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000515-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000515-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 606</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sequence</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-ivar">@sequences</span> <span class="ruby-operator">||=</span> []&#x000A;            <span class="ruby-ivar">@sequences</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000516'>
                <a name='M000516'>      </a>
                <div class='synopsis'>
                  <span class='name'>sequences</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  <a href="../Model.html">Model</a> sequences.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000516-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000516-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 612</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sequences</span>&#x000A;            <span class="ruby-ivar">@sequences</span> <span class="ruby-operator">||=</span> []&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000517'>
                <a name='M000517'>      </a>
                <div class='synopsis'>
                  <span class='name'>short_name</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Underscored local name (without namespaces)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000517-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000517-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 621</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">short_name</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">underscore</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/([^:]+)$/</span>)[<span class="ruby-value">1</span>])&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000500'>
                <a name='M000500'>      </a>
                <div class='synopsis'>
                  <span class='name'>static</span>
                  <span class='arguments'>(value=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an instance of the <a href="../Model.html">Model</a> with autoload
                  set to false
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000500-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000500-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 104</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">static</span>(<span class="ruby-identifier">value</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-identifier">obj</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-keyword kw">false</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000532'>
                <a name='M000532'>      </a>
                <div class='synopsis'>
                  <span class='name'>storage</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current default storage for the class The storage to use can be
                  set with <a href="BaseModel.html#M000531">use_storage</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000532-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000532-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 736</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">storage</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@storage</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@storage</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@use_storage</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:sub_model</span>])&#x000A;                <span class="ruby-ivar">@use_storage</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:sub_model</span>].<span class="ruby-identifier">use_storage</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@use_storage</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">get_storage</span>(<span class="ruby-ivar">@use_storage</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">get_storage</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000508'>
                <a name='M000508'>      </a>
                <div class='synopsis'>
                  <span class='name'>submodels</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  An array of other models this class points to.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000508-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000508-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 503</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">submodels</span>&#x000A;            <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">model?</span> }.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">model</span> }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000519'>
                <a name='M000519'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_s</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Name
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000519-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000519-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 631</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_s</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000531'>
                <a name='M000531'>      </a>
                <div class='synopsis'>
                  <span class='name'>use_storage</span>
                  <span class='arguments'>(name=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the url or the name of the storage to use
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000531-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000531-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 729</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_storage</span>(<span class="ruby-identifier">name</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-ivar">@use_storage</span> = <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>&#x000A;            <span class="ruby-ivar">@use_storage</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000539'>
                <a name='M000539'>      </a>
                <div class='synopsis'>
                  <span class='name'>where</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Constructs a <a href="Query.html">Query</a> based on params, and returns a
                  <a href="QuerySet.html">QuerySet</a> Allowed parameters are:
                  </p>
                  <ul>
                  <li>a <a href="Query.html">Query</a> object
                  
                  </li>
                  <li>a <a href="Condition.html">Condition</a> and an (optional) <a
                  href="Request.html">Request</a>, or anything that can be parsed by <a
                  href="Condition.html#M000625">Condition.new</a> and <a
                  href="Request.html#M000607">Request.new</a>
                  
                  </li>
                  </ul>
                  <p>
                  If a block is provided, it is passed to <a
                  href="Condition.html#M000626">Condition.parse_block</a>. Examples:
                  </p>
                  <pre>felines = Animals.where({:family =&gt; 'felines'})&#x000A;felines = Animals.where({:family =&gt; 'felines'}, [:name, :description])&#x000A;cool_animals = Animals.where{ (has_fangs == true) | (has_claws == true)}</pre>
                  <p>
                  See also <a href="Condition.html#M000626">Condition#parse_block</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000539-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000539-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 816</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Query</span>))&#x000A;                <span class="ruby-identifier">query</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>]&#x000A;                <span class="ruby-identifier">qs</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-keyword kw">elsif</span>(<span class="ruby-identifier">proc</span>)&#x000A;                <span class="ruby-identifier">qs</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)&#x000A;                <span class="ruby-identifier">qs</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-identifier">qs</span>.<span class="ruby-identifier">where</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">condition</span> = <span class="ruby-constant">Condition</span>.<span class="ruby-identifier">and</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>])&#x000A;                <span class="ruby-identifier">request</span> = <span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>])&#x000A;                <span class="ruby-identifier">query</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">condition</span>, <span class="ruby-identifier">request</span>)&#x000A;                <span class="ruby-identifier">qs</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">qs</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000529'>
                <a name='M000529'>      </a>
                <div class='synopsis'>
                  <span class='name'>with_mapper</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  The given proc will be mixed in the mapper used by this class Note that the
                  proc will be converted to a Module, so any overridden methods will still
                  have access to the super method.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000529-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000529-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 707</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_mapper</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-comment cmt"># @mapper_procs ||= []</span>&#x000A;            <span class="ruby-comment cmt"># @mapper_procs &lt;&lt; proc</span>&#x000A;            <span class="ruby-identifier">mod</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">mapper_include</span>(<span class="ruby-identifier">mod</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000530'>
                <a name='M000530'>      </a>
                <div class='synopsis'>
                  <span class='name'>with_mapper_for</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Like <a href="BaseModel.html#M000529">with_mapper</a>, but will mixin the
                  block only if the mapper matches params.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000530-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000530-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 723</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_mapper_for</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-ivar">@mapper_procs</span> <span class="ruby-operator">||=</span> []&#x000A;            <span class="ruby-ivar">@mapper_procs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000566'>
                <a name='M000566'>      </a>
                <div class='synopsis'>
                  <span class='name'>==</span>
                  <span class='arguments'>(other)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if other is_a?(self.class), and has the same values for this
                  class&#8217; primary keys.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000566-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000566-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1196</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-operator">==</span>(<span class="ruby-identifier">other</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">other</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>)&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">k</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000552'>
                <a name='M000552'>      </a>
                <div class='synopsis'>
                  <span class='name'>[]</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Calls <a href="BaseModel.html#M000549">get</a> on element; whenever no
                  getter responds, returns the extra data. See #[]=
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000552-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000552-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1013</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-keyword kw">begin</span>&#x000A;                <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@_extra</span>[<span class="ruby-identifier">element</span>]&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000553'>
                <a name='M000553'>      </a>
                <div class='synopsis'>
                  <span class='name'>[]=</span>
                  <span class='arguments'>(element, value)</span>
                </div>
                <div class='description'>
                  <p>
                  If element is a model&#8217;s element, calls <a
                  href="BaseModel.html#M000551">set</a>. Otherwise, stores the value in an
                  &#8220;extra&#8221; hash, where it will be accessible by #[]
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000553-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000553-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1024</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element</span>])&#x000A;                <span class="ruby-identifier">set</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-ivar">@_extra</span>[<span class="ruby-identifier">element</span>] = <span class="ruby-identifier">value</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000547'>
                <a name='M000547'>      </a>
                <div class='synopsis'>
                  <span class='name'>all_children</span>
                  <span class='arguments'>(path)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns all children that can be reached from the current path. Path is
                  expressed as a dotted String.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000547-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000547-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 953</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children</span>(<span class="ruby-identifier">path</span>)&#x000A;            <span class="ruby-identifier">children</span> = []&#x000A;            <span class="ruby-identifier">no_autoload</span> <span class="ruby-keyword kw">do</span>&#x000A;                <span class="ruby-identifier">el</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">shift</span>&#x000A;                <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">el</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">children</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)&#x000A;                    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span>&#x000A;                        <span class="ruby-identifier">children</span> = <span class="ruby-identifier">children</span>.<span class="ruby-identifier">all_children</span>(<span class="ruby-identifier">path</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">children</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000563'>
                <a name='M000563'>      </a>
                <div class='synopsis'>
                  <span class='name'>autoload=</span>
                  <span class='arguments'>(val)</span>
                </div>
                <div class='description'>
                  <p>
                  Enables or disables autoloading. An autoloading object will try to load all
                  missing elements on first access. (see also <a
                  href="Element.html#M000690">Element#lazy_groups</a>)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000563-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000563-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1147</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">autoload=</span>(<span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-identifier">autoload</span>(<span class="ruby-identifier">val</span>, <span class="ruby-keyword kw">false</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000562'>
                <a name='M000562'>      </a>
                <div class='synopsis'>
                  <span class='name'>autoload?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current autoload status
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000562-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000562-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1140</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">autoload?</span>&#x000A;            <span class="ruby-ivar">@_autoload</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000559'>
                <a name='M000559'>      </a>
                <div class='synopsis'>
                  <span class='name'>check</span>
                  <span class='arguments'>(name, val)</span>
                </div>
                <div class='description'>
                  <p>
                  Apply element checks for given element name and value. (See also <a
                  href="BaseModel.html#M000501">element</a>, :check attribute). Checks may be
                  defined by the <a href="../DataType.html">DataType</a>, or be given as an
                  element attribute. The check can be a Regexp, that will be checked against
                  the value, or a Proc, which is expected to return true if the check is
                  succesful, and false otherwise. Will raise a <a
                  href="FormatError.html">Model::FormatError</a> when a check is not
                  succesful. If the :check attribute is an Hash, the Hash keys will be used
                  as messages, which will be passed to the <a
                  href="FormatError.html">FormatError</a>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000559-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000559-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1102</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;            <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">val</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:check</span>))&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">checks</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:check</span>])&#x000A;                <span class="ruby-identifier">checks</span> = {(<span class="ruby-identifier">_</span>(<span class="ruby-value str">&quot;'%s' is not in the correct format&quot;</span>) <span class="ruby-operator">%</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">label</span>) =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">checks</span>} <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">checks</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;                <span class="ruby-identifier">checks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">msg</span>, <span class="ruby-identifier">check</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">test</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">check</span>&#x000A;                    <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Regexp</span>&#x000A;                        <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">val</span>)&#x000A;                    <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Proc</span>&#x000A;                        <span class="ruby-identifier">check</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">val</span>)&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-identifier">raise</span> <span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">val</span>, <span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000591'>
                <a name='M000591'>      </a>
                <div class='synopsis'>
                  <span class='name'>clear_values</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Sets all values to nil
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000591-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000591-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1492</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_values</span>()&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element_name</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:&quot;@#{element_name}&quot;</span>, <span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000577'>
                <a name='M000577'>      </a>
                <div class='synopsis'>
                  <span class='name'>clone</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a deep copy of the object
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000577-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000577-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1335</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clone</span>&#x000A;            <span class="ruby-identifier">obj</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>&#x000A;            <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000595'>
                <a name='M000595'>      </a>
                <div class='synopsis'>
                  <span class='name'>cut</span>
                  <span class='arguments'>(*params, &amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a part of the object tree, converted to Hashes, Arrays and Strings.
                  Arguments can be:
                  </p>
                  <ul>
                  <li>a String, followed by a list of elements; the String will be
                  sprintf&#8217;d with element values
                  
                  </li>
                  </ul>
                  <p>
                  or
                  </p>
                  <ul>
                  <li>a depth Fixnum; depth 0 means obj.to_s will be returned, depth 1 will
                  return an hash containing the object&#8217;s element values converted to
                  string, and so on
                  
                  </li>
                  </ul>
                  <p>
                  or
                  </p>
                  <ul>
                  <li>a Hash, whith element names as keys, and depths, or Hashes, or Procs as
                  values; each element will be traversed up to the depth given, or
                  recursively according to the has; or, if a Proc is given, it will be called
                  with the current object and element name as arguments
                  
                  </li>
                  </ul>
                  <p>
                  or
                  </p>
                  <ul>
                  <li>a list of elements; this is equivalent to passing a hash of the elements
                  with depth 0.
                  
                  </li>
                  </ul>
                  <p>
                  Examples:
                  </p>
                  <pre>obj.inspect&#x000A;  =&gt; Zoo::Animal: {:name =&gt; Llama, :family =&gt; Camelidae, :friends =&gt; Sheep, Camel}&#x000A;obj.cut(0)&#x000A;  =&gt; 'Llama'&#x000A;obj.cut(:name, :friends)&#x000A;  =&gt; {:name =&gt; 'Llama', :friends =&gt; 'Sheep, Camel'}&#x000A;obj.cut(:name =&gt; 0, :friends =&gt; 1)&#x000A;  =&gt; {:name =&gt; 'Llama', :friends =&gt; [&#x000A;        {:name =&gt; 'Sheep', :family =&gt; 'Bovidae', :friends =&gt; 'Llama'},&#x000A;        {:name =&gt; 'Camel', :family =&gt; 'Camelidae', :friens =&gt; 'Dromedary, LLama'}&#x000A;      ]}&#x000A;obj.cut(:name =&gt; 0, :friends =&gt; {:name =&gt; 0})&#x000A;  =&gt; {:name =&gt; 'Llama', :friends =&gt; [{:name =&gt; 'Sheep'}, {:name =&gt; 'Camel'}]}&#x000A;objs.cut(:name =&gt; 0, :friends =&gt; lambda{ |instance, element|&#x000A;   instance.get(element).name.upcase&#x000A;})&#x000A;  =&gt; {:name =&gt; 'Llama', :friends =&gt; ['SHEEP', 'CAMEL']}&#x000A;obj.cut(&quot;Hi, i'm a %s and my friends are %s&quot;, :name, :friends)&#x000A;  =&gt; &quot;Hi, i'm a Llama and my friends are Sheep, Camel&quot;</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000595-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000595-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1642</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cut</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">h</span> = {}&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>))&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>) })&#x000A;            <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>))&#x000A;                <span class="ruby-identifier">p</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">shift</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">p</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>)&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">block_given?</span>)&#x000A;                        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">proc</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_s</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">lev</span> = <span class="ruby-identifier">p</span>&#x000A;                <span class="ruby-identifier">where</span> = {}&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">where</span>[<span class="ruby-identifier">el</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">lev</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>}&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>))&#x000A;                <span class="ruby-identifier">where</span> <span class="ruby-operator">||=</span> {}&#x000A;                <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">where</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">v</span>}&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">where</span> <span class="ruby-operator">||=</span> {}&#x000A;                <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">where</span>[<span class="ruby-identifier">p</span>] = <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)}&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">with_identity_mapper</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">im</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">where</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">where</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>))&#x000A;                        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">where</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">name</span>)&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-identifier">el</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;                        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>&#x000A;                            <span class="ruby-identifier">val</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)&#x000A;                            <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">cut</span>(<span class="ruby-identifier">where</span>[<span class="ruby-identifier">name</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">model?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>&#x000A;                        <span class="ruby-keyword kw">else</span>&#x000A;                            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ModelException</span>, <span class="ruby-node">&quot;Element #{name} does not exist&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">name</span>)&#x000A;                            <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>)&#x000A;                            <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">cut</span>(<span class="ruby-identifier">where</span>[<span class="ruby-identifier">name</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">BaseModel</span>)&#x000A;                        <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-identifier">h</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">val</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">h</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000589'>
                <a name='M000589'>      </a>
                <div class='synopsis'>
                  <span class='name'>delete</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Deletes the object from the storage (see <a
                  href="Mapper.html#M000417">Mapper#delete</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000589-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000589-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1454</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-keyword kw">self</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000567'>
                <a name='M000567'>      </a>
                <div class='synopsis'>
                  <span class='name'>each</span>
                  <span class='arguments'>( {|element_name, element_value| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Iterates over elements and yields name-value pairs
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000567-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000567-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1210</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span> <span class="ruby-comment cmt"># :yields: element_name, element_value</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">get</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000568'>
                <a name='M000568'>      </a>
                <div class='synopsis'>
                  <span class='name'>each_val</span>
                  <span class='arguments'>( {|element_name, element_value| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Iterates over non-nil elements, yielding name-value pairs
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000568-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000568-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1217</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_val</span> <span class="ruby-comment cmt"># :yields: element_name, element_value</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">name</span>) }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">get</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000570'>
                <a name='M000570'>      </a>
                <div class='synopsis'>
                  <span class='name'>element_has_value?</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the element instance variable is set
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000570-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000570-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1234</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">element_name</span> = (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>)) <span class="ruby-operator">?</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">element</span>&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>]&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">:&quot;@#{element.integrated_from.name}&quot;</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from_element</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:computed_from</span>])&#x000A;                <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:computed_from</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>) }&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">mapped?</span>(<span class="ruby-identifier">element</span>))&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{element_name}?&quot;</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">respond_to?</span>(<span class="ruby-node">&quot;#{element_name}?&quot;</span>))&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">mapped?</span>(<span class="ruby-identifier">element</span>))&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">:&quot;@#{element_name}&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000557'>
                <a name='M000557'>      </a>
                <div class='synopsis'>
                  <span class='name'>element_loaded</span>
                  <span class='arguments'>(element_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Records that the element has been loaded.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000557-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000557-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1084</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">element_loaded</span>(<span class="ruby-identifier">element_name</span>)&#x000A;            <span class="ruby-identifier">element_name</span> = <span class="ruby-identifier">element_name</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element_name</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-ivar">@loaded_elements</span>[<span class="ruby-identifier">element_name</span>] = <span class="ruby-keyword kw">true</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000558'>
                <a name='M000558'>      </a>
                <div class='synopsis'>
                  <span class='name'>element_loaded?</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the element has been loaded by the mapper.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000558-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000558-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1090</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">element_loaded?</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@loaded_elements</span>[<span class="ruby-identifier">element</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000571'>
                <a name='M000571'>      </a>
                <div class='synopsis'>
                  <span class='name'>element_modified?</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the element value has been modified since instantiating or
                  loading
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000571-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000571-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1253</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">element_modified?</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">element</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element</span>]&#x000A;            <span class="ruby-identifier">set_mod</span> = <span class="ruby-ivar">@modified_elements</span>[<span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">set_mod</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">set_mod</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">element_modified?</span>(<span class="ruby-identifier">element</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">integrated</span> = <span class="ruby-identifier">get_no_load</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">integrated</span>.<span class="ruby-identifier">element_modified?</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from_element</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">element</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">val</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>)).<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:modified?</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">modified?</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000572'>
                <a name='M000572'>      </a>
                <div class='synopsis'>
                  <span class='name'>elements_modified?</span>
                  <span class='arguments'>(*elements)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if any of elements has been modified
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000572-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000572-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1268</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">elements_modified?</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">elements</span>)&#x000A;            <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element_modified?</span>(<span class="ruby-identifier">el</span>) }&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000575'>
                <a name='M000575'>      </a>
                <div class='synopsis'>
                  <span class='name'>empty?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if no element has a value
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000575-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000575-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1318</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">empty?</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@_has_values</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000549'>
                <a name='M000549'>      </a>
                <div class='synopsis'>
                  <span class='name'>get</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an element. The element may be a symbol, or a dotted path String.
                  Will call the associated getter.
                  </p>
                  <pre>cat.get('favorite_food.name')</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000549-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000549-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 981</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-identifier">first</span>, <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>, <span class="ruby-value">2</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">rest</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_sym</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">first</span>).<span class="ruby-identifier">get</span>(<span class="ruby-identifier">rest</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">element</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000578'>
                <a name='M000578'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_new</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a new instance with the same primary keys
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000578-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000578-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1342</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_new</span>&#x000A;            <span class="ruby-identifier">obj</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">k</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">k</span>)) }&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000550'>
                <a name='M000550'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_no_load</span>
                  <span class='arguments'>(element)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an element without autoloading it.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000550-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000550-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 992</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_no_load</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">nil</span>&#x000A;            <span class="ruby-identifier">no_autoload</span> <span class="ruby-keyword kw">do</span>&#x000A;                <span class="ruby-identifier">res</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000543'>
                <a name='M000543'>      </a>
                <div class='synopsis'>
                  <span class='name'>identity_mapper</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the instance&#8217;s <a
                  href="IdentityMapper.html">IdentityMapper</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000543-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000543-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 891</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">identity_mapper</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">identity_mapper</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">identity_mapper</span>&#x000A;            <span class="ruby-ivar">@identity_mapper</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">IdentityMapper</span>.<span class="ruby-identifier">new</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000544'>
                <a name='M000544'>      </a>
                <div class='synopsis'>
                  <span class='name'>identity_mapper=</span>
                  <span class='arguments'>(im)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the instance&#8217;s <a href="IdentityMapper.html">IdentityMapper</a>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000544-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000544-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 897</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">identity_mapper=</span>(<span class="ruby-identifier">im</span>)&#x000A;            <span class="ruby-ivar">@identity_mapper</span> = <span class="ruby-identifier">im</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000587'>
                <a name='M000587'>      </a>
                <div class='synopsis'>
                  <span class='name'>insert</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Inserts the object in the storage Note: if the object is already present in
                  the storage and unique indexes are enforced, this will raise an error. (See
                  <a href="Mapper.html#M000415">Mapper#insert</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000587-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000587-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1439</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert</span>&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-identifier">reset_modified_elements</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000593'>
                <a name='M000593'>      </a>
                <div class='synopsis'>
                  <span class='name'>inspect</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  A compact representation of the object. Note: inspect will not autoload the
                  object.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000593-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000593-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1550</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span><span class="ruby-operator">+</span><span class="ruby-value str">': {'</span> <span class="ruby-operator">+</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">element_loaded?</span>(<span class="ruby-identifier">el</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">el</span>.<span class="ruby-identifier">hidden?</span> } \&#x000A;                .<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;:#{el.name} =&gt; #{get(el.name).to_s}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">'}'</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000545'>
                <a name='M000545'>      </a>
                <div class='synopsis'>
                  <span class='name'>instantiate_element</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a new instance for given element name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000545-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000545-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 902</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">instantiate_element</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">multiple?</span>)&#x000A;                    <span class="ruby-identifier">val</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">static</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">model</span>)&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">new</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">val</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-identifier">autoload?</span>&#x000A;            <span class="ruby-keyword kw">end</span>       &#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">prepare_child</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">val</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000579'>
                <a name='M000579'>      </a>
                <div class='synopsis'>
                  <span class='name'>keys_to_condition</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a condition based on the current primary keys
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000579-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000579-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1349</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keys_to_condition</span>&#x000A;            <span class="ruby-identifier">c</span> = <span class="ruby-constant">Condition</span>.<span class="ruby-identifier">and</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">val</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">key</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">key</span>.<span class="ruby-identifier">model?</span>)&#x000A;                    <span class="ruby-identifier">c</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">keys_to_condition</span>&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">c</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">val</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">c</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000590'>
                <a name='M000590'>      </a>
                <div class='synopsis'>
                  <span class='name'>load</span>
                  <span class='arguments'>(*params)</span>
                </div>
                <div class='description'>
                  <p>
                  Loads the object from the storage Acceptable arguments are:
                  </p>
                  <ul>
                  <li>a <a href="Query.html">Query</a> object, or
                  
                  </li>
                  <li>a <a href="Request.html">Request</a> object, or a Hash, which will be
                  converted to a <a href="Request.html">Request</a>, or
                  
                  </li>
                  <li>a list of elements to request
                  
                  </li>
                  </ul>
                  <p>
                  It will then construct a <a href="Condition.html">Condition</a> with
                  current primary keys, and call <a
                  href="Mapper.html#M000427">Mapper#load</a> Note that an error will be
                  raised by the <a href="Mapper.html">Mapper</a> if not all primary keys are
                  set.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000590-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000590-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1465</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Query</span>)&#x000A;                <span class="ruby-identifier">query</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>]&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">primary_keys_set?</span>&#x000A;                <span class="ruby-identifier">query</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">new</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Request</span>))&#x000A;                    <span class="ruby-identifier">query</span>.<span class="ruby-identifier">request</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">shift</span>&#x000A;                <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>))&#x000A;                    <span class="ruby-identifier">query</span>.<span class="ruby-identifier">request</span> = <span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">shift</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                &#x000A;                <span class="ruby-identifier">elements</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">keys</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">element_loaded?</span>(<span class="ruby-identifier">el</span>) }.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;                <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">query</span>.<span class="ruby-identifier">request</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword kw">true</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">query</span>.<span class="ruby-identifier">condition</span>.<span class="ruby-identifier">conjunction</span> = <span class="ruby-identifier">:and</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">query</span>.<span class="ruby-identifier">condition</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">name</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-comment cmt">#clear_values()</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">load</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">query</span>) &#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000583'>
                <a name='M000583'>      </a>
                <div class='synopsis'>
                  <span class='name'>mapper</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current mapper, or instantiates a new one (base on the current
                  storage, if set)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000583-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000583-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1404</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mapper</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@storage</span>)&#x000A;                <span class="ruby-ivar">@mapper</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_mapper</span>(<span class="ruby-ivar">@storage</span>)&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-ivar">@mapper</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">mapper</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@mapper</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000584'>
                <a name='M000584'>      </a>
                <div class='synopsis'>
                  <span class='name'>mapper=</span>
                  <span class='arguments'>(mapper)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the current mapper
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000584-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000584-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1414</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mapper=</span>(<span class="ruby-identifier">mapper</span>)&#x000A;            <span class="ruby-ivar">@mapper</span> = <span class="ruby-identifier">mapper</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000576'>
                <a name='M000576'>      </a>
                <div class='synopsis'>
                  <span class='name'>merge!</span>
                  <span class='arguments'>(obj)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets all values of obj on the current object, cloning them if possible
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000576-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000576-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1323</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">obj</span>)&#x000A;            <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">el</span>.<span class="ruby-identifier">integrated?</span>}.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">val</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">BaseModel</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:clone</span>))&#x000A;                    <span class="ruby-keyword kw">begin</span>; <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">clone</span>; <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span>; <span class="ruby-keyword kw">end</span>;&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">set_loaded_value</span>(<span class="ruby-identifier">el</span>, <span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-ivar">@loaded_elements</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">loaded_elements</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000573'>
                <a name='M000573'>      </a>
                <div class='synopsis'>
                  <span class='name'>modified?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if any element, or any child object, has been modified
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000573-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000573-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1274</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">modified?</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@modified_elements</span>.<span class="ruby-identifier">reject</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span> }.<span class="ruby-identifier">empty?</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> &#x000A;                <span class="ruby-operator">!</span><span class="ruby-identifier">el</span>.<span class="ruby-identifier">model?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">DataType</span>)&#x000A;            }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>).<span class="ruby-identifier">modified?</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000564'>
                <a name='M000564'>      </a>
                <div class='synopsis'>
                  <span class='name'>no_autoload</span>
                  <span class='arguments'>() {|| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Disables autoload. If a block is given, the current autoload setting will
                  be restored after yielding.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000564-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000564-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1169</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">no_autoload</span>&#x000A;            <span class="ruby-identifier">prev_autoload</span> = <span class="ruby-identifier">autoload?</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-keyword kw">false</span>&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>&#x000A;                <span class="ruby-keyword kw">yield</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-identifier">prev_autoload</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000580'>
                <a name='M000580'>      </a>
                <div class='synopsis'>
                  <span class='name'>observe_all_values</span>
                  <span class='arguments'>(&amp;proc)</span>
                </div>
                <div class='description'>
                  <p>
                  The given block will be called whenever a value is modified. The block will
                  be passed three arguments: the object, the element name, and the previous
                  value Example:
                  </p>
                  <pre>obj.observe_all_values do |instance, element_name, old_val|&#x000A;  puts &quot;#{element_name} for object #{instance} has changed from #{old_val} to #{instance.get(element_name) }&quot;</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000580-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000580-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1372</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">observe_all_values</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-ivar">@all_values_observers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000560'>
                <a name='M000560'>      </a>
                <div class='synopsis'>
                  <span class='name'>polymorphic_become</span>
                  <span class='arguments'>(model)</span>
                </div>
                <div class='description'>
                  <p>
                  Converts the object to the instance of a subclass for which this model is
                  polymorphic.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000560-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000560-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1120</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">polymorphic_become</span>(<span class="ruby-identifier">model</span>)&#x000A;            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ModelException</span>, <span class="ruby-node">&quot;#{self.class} is not polymorphic for #{model}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">polymorphic_models</span>[<span class="ruby-identifier">model</span>]&#x000A;            <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">new</span>&#x000A;            <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">polymorphic_models</span>[<span class="ruby-identifier">model</span>][<span class="ruby-identifier">:through</span>], <span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000546'>
                <a name='M000546'>      </a>
                <div class='synopsis'>
                  <span class='name'>prepare_child</span>
                  <span class='arguments'>(name, obj)</span>
                </div>
                <div class='description'>
                  <p>
                  Prepares an object that is being set as a child.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000546-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000546-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 916</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_child</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">obj</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">nil?</span>&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">name</span>]&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>)&#x000A;                <span class="ruby-comment cmt"># convert between junction and real type if needed</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">QuerySet</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction</span>])&#x000A;                    <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no_autoload</span> <span class="ruby-keyword kw">do</span>&#x000A;                        <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:keep_junction</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">model</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>)&#x000A;                            <span class="ruby-identifier">qs</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">model</span>)&#x000A;                            <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el_obj</span><span class="ruby-operator">|</span> &#x000A;                                <span class="ruby-identifier">qs</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">element</span>.<span class="ruby-identifier">reverse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_their_element</span>] =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">el_obj</span>}&#x000A;                            }&#x000A;                            <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">qs</span>&#x000A;                        <span class="ruby-keyword kw">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:keep_junction</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">model</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model</span>)&#x000A;                            <span class="ruby-identifier">qs</span> = <span class="ruby-constant">QuerySet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el_obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el_obj</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_their_element</span>])})&#x000A;                            <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">qs</span>&#x000A;                        <span class="ruby-keyword kw">end</span> &#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">identity_mapper</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">identity_mapper</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:keep_junction</span>])&#x000A;                    <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">append_element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:junction_their_element</span>]&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:set</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:set</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>))&#x000A;                    <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:set</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>) }&#x000A;                    <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">reset_modified_elements</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:set</span>].<span class="ruby-identifier">keys</span>)&#x000A;                    <span class="ruby-comment cmt"># FIXME: is it always ok to not set the element as modified? But otherwise sub objects</span>&#x000A;                    <span class="ruby-comment cmt"># are always saved (and that's definitely no good)</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">obj</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000555'>
                <a name='M000555'>      </a>
                <div class='synopsis'>
                  <span class='name'>prepare_value</span>
                  <span class='arguments'>(element, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Prepares a value going to be set on the object. Will convert the value to
                  the appropriate type.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000555-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000555-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1040</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">DataType</span>)&#x000A;                <span class="ruby-identifier">value</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">from_value</span>(<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>)&#x000A;                <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">take_attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">value</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">a</span>] = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">a</span>]&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>&#x000A;                <span class="ruby-identifier">value</span>.<span class="ruby-identifier">autoload</span>(<span class="ruby-identifier">autoload?</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span>&#x000A;                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Date'</span>, <span class="ruby-value str">'DateTime'</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>&#x000A;                    <span class="ruby-keyword kw">begin</span>&#x000A;                        <span class="ruby-identifier">value</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)&#x000A;                    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>&#x000A;                        <span class="ruby-identifier">raise</span> <span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">_</span>(<span class="ruby-value str">&quot;'%s' is not a valid date&quot;</span>))&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'String'</span>&#x000A;                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Spider::DataTypes::Text'</span>&#x000A;                    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>&#x000A;                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Fixnum'</span>&#x000A;                    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">value</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000569'>
                <a name='M000569'>      </a>
                <div class='synopsis'>
                  <span class='name'>primary_keys</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of current primary key values
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000569-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000569-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1224</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_keys</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">k</span>) }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000574'>
                <a name='M000574'>      </a>
                <div class='synopsis'>
                  <span class='name'>primary_keys_set?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if all primary keys have a value; false if some primary key is
                  not set or the model has no primary key
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000574-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000574-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1302</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_keys_set?</span>&#x000A;            <span class="ruby-identifier">primary_keys</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;            <span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">el</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">int_obj</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">:&quot;@#{el.integrated_from.name}&quot;</span>))&#x000A;                    <span class="ruby-comment cmt">#return false unless int_obj.instance_variable_get(:&quot;@#{el.integrated_from_element}&quot;)</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int_obj</span>.<span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">integrated_from_element</span>)&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">:&quot;@#{el.name}&quot;</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000585'>
                <a name='M000585'>      </a>
                <div class='synopsis'>
                  <span class='name'>save</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Saves the object to the storage (see <a
                  href="Mapper.html#M000409">Mapper#save</a>)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000585-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000585-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1424</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-identifier">reset_modified_elements</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000586'>
                <a name='M000586'>      </a>
                <div class='synopsis'>
                  <span class='name'>save_all</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Saves the object and all child objects to the storage (see <a
                  href="Mapper.html#M000414">Mapper#save_all</a>)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000586-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000586-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1431</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_all</span>&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">save_all</span>(<span class="ruby-keyword kw">self</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000565'>
                <a name='M000565'>      </a>
                <div class='synopsis'>
                  <span class='name'>save_mode</span>
                  <span class='arguments'>() {|| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Sets autoload to :<a href="BaseModel.html#M000565">save_mode</a>; elements
                  will be autoloaded only one by one, so that any already set data will not
                  be overwritten If a block is given, the current autoload setting will be
                  restored after yielding.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000565-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000565-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1181</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_mode</span>&#x000A;            <span class="ruby-identifier">prev_autoload</span> = <span class="ruby-identifier">autoload?</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-identifier">:save_mode</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">block_given?</span>)&#x000A;                <span class="ruby-keyword kw">yield</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autoload</span> = <span class="ruby-identifier">prev_autoload</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000551'>
                <a name='M000551'>      </a>
                <div class='synopsis'>
                  <span class='name'>set</span>
                  <span class='arguments'>(element, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets an element. The element can be a symbol, or a dotted path String. Will
                  call the associated setter.
                  </p>
                  <pre>cat.set('favorite_food.name', 'Salmon')</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000551-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000551-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1004</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Element</span>)&#x000A;            <span class="ruby-identifier">first</span>, <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>, <span class="ruby-value">2</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">first</span>).<span class="ruby-identifier">set</span>(<span class="ruby-identifier">rest</span>, <span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">rest</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{element}=&quot;</span>, <span class="ruby-identifier">value</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000554'>
                <a name='M000554'>      </a>
                <div class='synopsis'>
                  <span class='name'>set_hash</span>
                  <span class='arguments'>(hash)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets each value of a Hash.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000554-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000554-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1034</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_hash</span>(<span class="ruby-identifier">hash</span>)&#x000A;            <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span>) }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000556'>
                <a name='M000556'>      </a>
                <div class='synopsis'>
                  <span class='name'>set_loaded_value</span>
                  <span class='arguments'>(element, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets a value without calling the associated setter; used by the mapper.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000556-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000556-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1069</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_loaded_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-identifier">element_name</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Element</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">element</span>&#x000A;            <span class="ruby-identifier">element</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-identifier">element_name</span>]&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated?</span>)&#x000A;                <span class="ruby-identifier">get</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from</span>).<span class="ruby-identifier">set_loaded_value</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">integrated_from_element</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">value</span> = <span class="ruby-identifier">prepare_child</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">model?</span>&#x000A;                <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-node">&quot;@#{element_name}&quot;</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">value</span>.<span class="ruby-identifier">loaded</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">QuerySet</span>))&#x000A;            <span class="ruby-identifier">element_loaded</span>(<span class="ruby-identifier">element_name</span>)&#x000A;            <span class="ruby-ivar">@modified_elements</span>[<span class="ruby-identifier">element_name</span>] = <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000548'>
                <a name='M000548'>      </a>
                <div class='synopsis'>
                  <span class='name'>set_parent</span>
                  <span class='arguments'>(obj, element)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the object currently containing this one (<a
                  href="BaseModel.html">BaseModel</a> or <a
                  href="QuerySet.html">QuerySet</a>)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000548-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000548-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 967</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_parent</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">element</span>)&#x000A;            <span class="ruby-ivar">@_parent</span> = <span class="ruby-identifier">obj</span>&#x000A;            <span class="ruby-ivar">@_parent_element</span> = <span class="ruby-identifier">element</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000581'>
                <a name='M000581'>      </a>
                <div class='synopsis'>
                  <span class='name'>storage</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current @storage, or instantiates the default calling
                  Spider::BaseModel.storage
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000581-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000581-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1389</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">storage</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@storage</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">storage</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000561'>
                <a name='M000561'>      </a>
                <div class='synopsis'>
                  <span class='name'>subclass</span>
                  <span class='arguments'>(model)</span>
                </div>
                <div class='description'>
                  <p>
                  Converts the object to the instance of a subclass. This will instantiate
                  the model passed as an argument, and set each value of the current object
                  on the new one. No checks are made that this makes sense, so the method
                  will fail if the &#8220;subclass&#8221; does not contain all of the current
                  model&#8217;s elements.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000561-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000561-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1131</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">subclass</span>(<span class="ruby-identifier">model</span>)&#x000A;            <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">new</span>&#x000A;            <span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">el</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000596'>
                <a name='M000596'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_hash</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a element_name => value Hash
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000596-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000596-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1688</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_hash</span>()&#x000A;            <span class="ruby-identifier">h</span> = {}&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">element_loaded?</span> <span class="ruby-identifier">el</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">h</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">h</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000594'>
                <a name='M000594'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_json</span>
                  <span class='arguments'>(state=nil) {|self, el| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a JSON representation of the object.
                  </p>
                  <p>
                  The tree will be traversed outputting all encountered objects; when an
                  already seen object is met, the primary keys will be output (as a single
                  value if one, as an array if many) and traversing will stop.
                  </p>
                  <p>
                  For more fine-grained control of the output, it is better to use the <a
                  href="BaseModel.html#M000595">cut</a> method and call <a
                  href="BaseModel.html#M000594">to_json</a> on it.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000594-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000594-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1563</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_json</span>(<span class="ruby-identifier">state</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)&#x000A;            <span class="ruby-identifier">ic</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'UTF-8//IGNORE'</span>, <span class="ruby-value str">'UTF-8'</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@tmp_json_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>)&#x000A;                <span class="ruby-identifier">pks</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">primary_keys</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">k</span>).<span class="ruby-identifier">to_json</span> }&#x000A;                <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">pks</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pks</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pks</span>.<span class="ruby-identifier">to_json</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-ivar">@tmp_json_seen</span> = <span class="ruby-keyword kw">true</span>&#x000A;            <span class="ruby-identifier">json</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;            <span class="ruby-comment cmt">#Spider::Model.with_identity_mapper do |im|</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_model</span>] }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                    (<span class="ruby-identifier">int</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value str">&quot;@tmp_json_seen&quot;</span>, <span class="ruby-keyword kw">true</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">block_given?</span>)&#x000A;                    <span class="ruby-identifier">select_elements</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>{ <span class="ruby-keyword kw">true</span> }&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">select_elements</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                        <span class="ruby-operator">!</span><span class="ruby-identifier">el</span>.<span class="ruby-identifier">hidden?</span>&#x000A;                        <span class="ruby-comment cmt">#  &amp;&amp;</span>&#x000A;                        <span class="ruby-comment cmt"># #!el.attributes[:integrated_model]  &amp;&amp; </span>&#x000A;                        <span class="ruby-comment cmt"># (element_has_value?(el) || (el.integrated? &amp;&amp; element_has_value?(el.integrated_from)))</span>&#x000A;                     }&#x000A;                 <span class="ruby-keyword kw">end</span>&#x000A;                &#x000A;                <span class="ruby-identifier">json</span> = <span class="ruby-value str">&quot;{&quot;</span> <span class="ruby-operator">+</span>&#x000A;                        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">select</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">select_elements</span>).<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">block_given?</span>)&#x000A;                                 <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">yield</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">el</span>)&#x000A;                                 <span class="ruby-identifier">val</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;#{name}: #{val}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>&#x000A;                             <span class="ruby-keyword kw">else</span>&#x000A;                                 <span class="ruby-identifier">val</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">name</span>)&#x000A;                                 <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'text'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'longText'</span>)&#x000A;                                     <span class="ruby-identifier">val</span> = <span class="ruby-identifier">ic</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">' '</span>)[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]&#x000A;                                 <span class="ruby-keyword kw">end</span>&#x000A;                                 <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_json</span>&#x000A;                                 <span class="ruby-node">&quot;#{name}: #{val}&quot;</span>&#x000A;                             <span class="ruby-keyword kw">end</span>&#x000A;                        }.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pair</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pair</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;}&quot;</span>&#x000A;                <span class="ruby-ivar">@tmp_json_seen</span> = <span class="ruby-keyword kw">false</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:integrated_model</span>] }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                    (<span class="ruby-identifier">int</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value str">&quot;@tmp_json_seen&quot;</span>, <span class="ruby-keyword kw">false</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-comment cmt">#end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">json</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000592'>
                <a name='M000592'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_s</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a descriptive string for the object. By default this method returns
                  the value of the first String element, if any; otherwise, the string
                  representation of the first element of any type. Descendant classes may
                  well provide a better representation.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000592-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000592-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1533</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">each_element</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">el</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">el</span>.<span class="ruby-identifier">primary_key?</span>)&#x000A;                    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">el</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">elements_array</span>[<span class="ruby-value">0</span>]&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element_has_value?</span>(<span class="ruby-identifier">el</span>)&#x000A;                <span class="ruby-identifier">v</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">el</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">v</span>  <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000588'>
                <a name='M000588'>      </a>
                <div class='synopsis'>
                  <span class='name'>update</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Updates the object in the storage Note: the update will silently fail if
                  the object is not present in the storage (see <a
                  href="Mapper.html#M000416">Mapper#update</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000588-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000588-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1447</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>&#x000A;            <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">update</span>(<span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-identifier">reset_modified_elements</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000582'>
                <a name='M000582'>      </a>
                <div class='synopsis'>
                  <span class='name'>use_storage</span>
                  <span class='arguments'>(storage)</span>
                </div>
                <div class='description'>
                  <p>
                  Instantiates the storage for the instance. Accepts a string (url or named
                  storage) which will be passed to Spider::BaseModel.get_storage Example:
                  </p>
                  <pre>obj.use_storage('my_named_db')&#x000A;obj.use_storage('db:oracle://username:password@XE')</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000582-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000582-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/base_model.rb, line 1398</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_storage</span>(<span class="ruby-identifier">storage</span>)&#x000A;            <span class="ruby-ivar">@storage</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_storage</span>(<span class="ruby-identifier">storage</span>)&#x000A;            <span class="ruby-ivar">@mapper</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_mapper</span>(<span class="ruby-ivar">@storage</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
